# Release Artifact Contract

This document defines the compatibility contract between `repath-model` releases and consumers like `repath-mobile`.

## Scope

A model release must provide everything required for mobile runtime inference and integrity verification.

## Required release assets

Each GitHub release tag `vX.Y.Z` must include:
- `yolo-repath-vX.Y.Z.tflite`
- `yolo-repath-vX.Y.Z.labels.json`
- `release-manifest-vX.Y.Z.json`
- `SHA256SUMS`

## Filename conventions

- Model filename: `yolo-repath-vX.Y.Z.tflite`
- Labels filename: `yolo-repath-vX.Y.Z.labels.json`
- Manifest filename: `release-manifest-vX.Y.Z.json`

These names are generated by `scripts/release/build_release.py`.

## Manifest schema

Current manifest fields:
- `name` (string): model family name, currently `yolo-repath`
- `version` (string): semver without `v` prefix
- `tag` (string): release tag with `v` prefix
- `generated_at` (ISO timestamp)
- `source` (object): source model/labels path and optional run id
- `artifacts` (array): one record per shipped artifact
- `notes` (string): optional release notes text

Each `artifacts[]` entry must include:
- `filename` (string)
- `sha256` (hex string)
- `bytes` (integer)
- `content_type` (string)

## Consumer verification requirements

Consumers should:
1. Download model, labels, and release manifest.
2. Compute SHA256 of downloaded model and labels.
3. Match checksums against manifest entries for the exact release asset filenames.
4. Fail pull/install when checksums mismatch or required manifest entries are missing.

`repath-mobile/scripts/pull-model-release.js` enforces this by default.

## Compatibility guarantees

- Patch and minor versions may improve accuracy, labels, or metadata, but must preserve required assets and manifest structure.
- Breaking release-layout or manifest-schema changes require a major version bump and consumer migration notes.

## Publishing checklist

Before creating a release:
- Build bundle with `scripts/release/build_release.py`.
- Verify bundle with `scripts/release/verify_release.py`.
- Confirm all required assets are attached to the GitHub release.
- Update `release-notes.md` with actual benchmark and run details.

## Legacy/exception handling

If a legacy release does not include a manifest, consumers may support explicit opt-out behavior (for example, `--skip-verify`) but this is not the default and should be treated as non-standard.
